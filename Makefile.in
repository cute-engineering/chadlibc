CC		?= gcc
LD		= ld
AR		= ar
RM		= rm -f

CFLAGS	+= -Wall -Werror -Wextra -fpic -fno-builtin -nostdlib \
			 -nostdinc -Iinclude
ifneq ($(CC), tcc)
CFLAGS	+= -ansi -pedantic
endif
LDFLAGS	+= -nostdlib -shared
ARFLAGS	= rcs

SYSDEPS_PATH	= %(SYSDEPS_SRC)

include src/build.mk

OBJS	= $(addprefix src/, $(SRCS:.c=.o))

LIB_SHARED	= libc.so
LIB_STATIC	= libc.a
TARGET		= $(LIB_STATIC)
ifeq (%(SYSDEPS_SHARED), 1)
TARGET		+= $(LIB_SHARED)
endif


include sysdeps/%(SYSDEPS_SRC)/build.mk

all: $(TARGET)

$(LIB_STATIC): $(OBJS)
	$(AR) $(ARFLAGS) $@ $^

$(LIB_SHARED): $(OBJS)
	$(LD) $(LDFLAGS) -o $@ $^

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

clean:
	$(RM) $(OBJS) $(TARGET)

re: clean all

.PHONY: all clean re

include test/build.mk